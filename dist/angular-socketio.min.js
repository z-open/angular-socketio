!function(){"use strict";angular.module("socketio-auth",[])}(),function(){"use strict";function n(){var n,t,o;this.setLoginUrl=function(t){n=t},this.setLogoutUrl=function(n){t=n},this.setReconnectionMaxTimeInSecs=function(n){o=1e3*n},this.$get=["$rootScope","$location","$timeout","$q","$window",function(e,c,i,r,u){function a(){return m||d(),s()}function f(){m&&m.emit("logout",v)}function s(){var n=r.defer();return g.connected?n.resolve(m):l().then(function(){n.resolve(m)})["catch"](function(t){n.reject("USER_NOT_CONNECTED")}),n.promise}function l(){var n=r.defer();g.connected&&n.resolve(m);var t,c=e.$on("user_connected",function(){c(),t&&i.cancel(t),n.resolve(m)});return t=i(function(){c(),n.reject("TIMEOUT")},3e4|o),n.promise}function d(){function o(){s(!1),m.emit("authenticate",{token:v})}function c(){s(!1)}function r(n){d(),localStorage.token=n,v=n,l(v),s(!0),$(v),e.$broadcast("user_connected")}function a(){d(),delete localStorage.token,s(!1),p(t||n)}function f(t){d(),s(!1),p(n)}function s(n){g.connected=n}function l(n){var t=h(n);g.id=t.id,g.display=t.display,g.firstName=t.firstName,g.lastName=t.lastName,g.role=t.role}function d(){N&&i.cancel(N)}function h(n){var t=n.split(".")[1],o=t.replace("-","+").replace("_","/"),e=JSON.parse(u.atob(o));return e}function $(n){var t=h(n,{complete:!1}),o=t.dur,e=90*o/100|0;N=i(function(){m.emit("authenticate",{token:n})},1e3*e)}if(!m){var N;m=io.connect({forceNew:!0}),m.on("connect",o).on("authenticated",r).on("unauthorized",f).on("logged_out",a).on("disconnect",c),m.on("connect_error",function(){s(!1)})}}function h(){var n=c.search().token;return n||(n=localStorage.token),n}function p(n){window.location.replace(n||"badUrl.html")}var m,v=h(),g={};return e.sessionUser=g,v&&(localStorage.token=v),{connect:a,logout:f}}]}angular.module("socketio-auth").provider("$auth",n)}(),function(){"use strict";function n(n,t,o){function e(t,e){o.connect().then(function(o){o.on(t,function(){var t=arguments;n.$apply(function(){e.apply(o,t)})})})}function c(t,e,c){o.connect().then(function(o){o.emit(t,e,function(){var t=arguments;n.$apply(function(){c&&c.apply(o,t)})})})}function i(n,t){return a(n,t)}function r(n,t){return a(n,t)}function u(n,t){return a(n,t)}function a(n,e){function c(o){var c=t.defer();return o.emit("api",n,e,function(n){n.code?c.reject({code:n.code,description:n.data}):c.resolve(n.data)}),c.promise}function i(n){return t.reject({code:"CONNECTION_ERR",description:n})}return o.connect().then(c,i)}this.on=e,this.emit=c,this.logout=o.logout,this.fetch=i,this.post=u,this.notify=r}n.$inject=["$rootScope","$q","$auth"],angular.module("socketio-auth").service("$socketio",n)}();