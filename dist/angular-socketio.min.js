!function(){"use strict";angular.module("socketio-auth",[])}(),function(){"use strict";function n(){var n,t,e=15;this.setLoginUrl=function(t){n=t},this.setLogoutUrl=function(n){t=n},this.setReconnectionMaxTimeInSecs=function(n){e=1e3*n},this.$get=["$rootScope","$location","$timeout","$q","$window",function(o,c,i,r,u){function a(){return p||d(),f()}function s(){p&&p.emit("logout",m)}function f(){var n=r.defer();return g.connected?n.resolve(p):l().then(function(){n.resolve(p)})["catch"](function(t){n.reject("USER_NOT_CONNECTED")}),n.promise}function l(){var n=r.defer();g.connected&&n.resolve(p);var t,c=o.$on("user_connected",function(){c(),t&&i.cancel(t),n.resolve(p)});return t=i(function(){c(),n.reject("TIMEOUT")},e),n.promise}function d(){function e(){f(!1),p.emit("authenticate",{token:m})}function c(){f(!1)}function r(n){d(),localStorage.token=n,m=n,l(m),f(!0),$(m),o.$broadcast("user_connected")}function a(){d(),delete localStorage.token,f(!1),v(t||n)}function s(t){d(),f(!1),v(n)}function f(n){g.connected=n}function l(n){var t=h(n);g.id=t.id,g.display=t.display,g.firstName=t.firstName,g.lastName=t.lastName,g.role=t.role}function d(){N&&i.cancel(N)}function h(n){var t=n.split(".")[1],e=t.replace("-","+").replace("_","/"),o=JSON.parse(u.atob(e));return o}function $(n){var t=h(n,{complete:!1}),e=t.dur,o=90*e/100|0;N=i(function(){p.emit("authenticate",{token:n})},1e3*o)}if(!p){var N;p=io.connect({forceNew:!0}),p.on("connect",e).on("authenticated",r).on("unauthorized",s).on("logged_out",a).on("disconnect",c),p.on("connect_error",function(){f(!1)})}}function h(){var n=c.search().token;return n||(n=localStorage.token),n}function v(n){window.location.replace(n||"badUrl.html")}var p,m=h(),g={};return o.sessionUser=g,m&&(localStorage.token=m),{connect:a,logout:s}}]}angular.module("socketio-auth").provider("$auth",n)}(),function(){"use strict";function n(n,t,e){function o(t,o){e.connect().then(function(e){e.on(t,function(){var t=arguments;n.$apply(function(){o.apply(e,t)})})})}function c(t,o,c){e.connect().then(function(e){e.emit(t,o,function(){var t=arguments;n.$apply(function(){c&&c.apply(e,t)})})})}function i(n,t){return a(n,t)}function r(n,t){return a(n,t)}function u(n,e){return e.version?e.version>0&&(e.version=-e.version-1):e.version=-1,a(n,e).then(function(n){return e.version=Math.abs(e.version),n})["catch"](function(n){return"ALREADY_SUBMITTED"==n.code?(e.version=Math.abs(e.version),t.resolve(e)):t.reject(n)})}function a(n,o){function c(e){var c=t.defer();return e.emit("api",n,o,function(n){n.code?c.reject({code:n.code,description:n.data}):c.resolve(n.data)}),c.promise}function i(n){return t.reject({code:"CONNECTION_ERR",description:n})}return e.connect().then(c,i)}this.on=o,this.emit=c,this.logout=e.logout,this.fetch=i,this.post=u,this.notify=r}n.$inject=["$rootScope","$q","$auth"],angular.module("socketio-auth").service("$socketio",n)}();